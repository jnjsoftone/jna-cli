"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),!function(e,o){for(var t in o)Object.defineProperty(e,t,{enumerable:!0,get:o[t]})}(exports,{cloneRepo:function(){return g},copyRepo:function(){return d},createRemoteRepo:function(){return l},deleteRemoteRepo:function(){return a},findAllRepos:function(){return s},findGithubAccount:function(){return i},initLocalRepo:function(){return p},initRepo:function(){return m},makeRepo:function(){return f},pushRepo:function(){return $},removeRepo:function(){return R},setLocalConfig:function(){return u}});const o=(e=require("path"))&&e.__esModule?e:{default:e},t=require("child_process"),n=require("jnu-abc"),r=require("jnu-cloud"),c=require("./cli.js"),i=(e,o="local",t={})=>{if("local"===o){let o=process.env.DEV_ROOT?`${process.env.DEV_ROOT}/jd-environments`:"C:/JnJ/Developments/jd-environments";return(0,n.loadJson)(`${o}/Apis/github.json`)[e]}if("github"===o){console.log(`#### ENV_GITHUB_OWNER: ${process.env.ENV_GITHUB_OWNER}`),console.log(`#### ENV_GITHUB_REPO: ${process.env.ENV_GITHUB_REPO}`),console.log(`#### ENV_GITHUB_TOKEN: ${process.env.ENV_GITHUB_TOKEN}`);let e={owner:process.env.ENV_GITHUB_OWNER||"",repo:process.env.ENV_GITHUB_REPO||"",token:process.env.ENV_GITHUB_TOKEN||""};return(0,r.readJsonFromGithub)("Apis/github.json",e)}},s=async e=>(await e.rest.repos.listForAuthenticatedUser({per_page:100,sort:"updated"})).data,l=(e,o)=>{console.log("####@@@@@ createRemoteRepo options: ",o);let{name:t,description:n,isPrivate:r}=o;return e.rest.repos.createForAuthenticatedUser({name:t,description:n,private:r,auto_init:!0})},a=(e,o,t)=>{let{name:n}=o;return console.log(`### deleteRemoteRepo: ${n}`),e.rest.repos.delete({owner:t.userName,repo:n})},u=(e,o,n)=>{let r=`cd ${n} && git config user.name "${o.fullName}"`;console.log(r+=` && git config user.email "${o.email}" && git remote set-url origin https://${o.token}@github.com/${o.userName}/${e.name}.git`),(0,t.execSync)(r)},p=(e,o,n)=>{let{name:r}=e,{fullName:c,email:i,token:s,userName:l}=o,a=`cd ${n} && git init`;(0,t.execSync)(a);try{a="git branch -m master main",(0,t.execSync)(a)}catch(e){console.log("####@@@@@===== error: ",e)}console.log(a=`git config user.name "${c}" && git config user.email "${i}" && git remote add origin https://${s}@github.com/${l}/${r}.git && git add . && git commit -m "Initial commit"`),(0,t.execSync)(a)},g=(e,n,r)=>{let c=`cd ${o.default.dirname(r)} && git clone https://${n.token}@github.com/${n.userName}/${e.name}.git`;console.log(c),(0,t.execSync)(c)},m=(e,o,r,c)=>{let i=`xgit -e createRemoteRepo -u ${r.userName} -n ${o.name} -d "${o.description}" -p ${o.isPrivate}`;console.log(`initRepo cmd: ${i}`),(0,t.execSync)(i),(0,n.sleep)(10),g(o,r,c),(0,n.sleep)(5),u(o,r,c)},d=(e,o,t)=>{g(e,o,t),(0,n.sleep)(10),u(e,o,t)},$=(e,o,n)=>{if((0,t.execSync)(`cd ${n}`),(0,t.execSync)("git status --porcelain",{encoding:"utf8"}).length>0){let e='git add . && git commit -m "Initial commit"';console.log("#### ",e),(0,t.execSync)(e)}let r=(0,t.execSync)("git branch");console.log(`#### pushRepo branches: ${r}`),r.includes("main")?(0,t.execSync)("git push -u origin main --force"):r.includes("master")?(0,t.execSync)("git push -u origin master --force"):console.log("main 또는 master 브랜치가 없습니다.")},f=(e,o,r,c)=>{console.log("####@@@@@===== makeRepo options: ",JSON.stringify(o));let i=`xgit -e createRemoteRepo -u ${r.userName} -n ${o.name} -d "${o.description}" -p ${o.isPrivate}`;console.log(`initRepo cmd: ${i}`),(0,t.execSync)(i),(0,n.sleep)(15),console.log(`=================== initLocalRepo: ${c}`),p(o,r,c),(0,n.sleep)(5),console.log(`=================== pushRepo: ${c}`),$(o,r,c)},R=(e,r,i,s)=>{a(e,r,i),(0,n.sleep)(10);let{name:l}=r;if("win"===c.PLATFORM)try{let e=`cd ${o.default.dirname(s)}`;console.log(e),(0,t.execSync)(e);let n=`rmdir /s /q ${l}`;console.log(n),(0,t.execSync)(n)}catch(e){console.error("Failed to remove directory:",e);try{let e=`rd /s /q "${s}"`;console.log("Trying alternative command:",e),(0,t.execSync)(e)}catch(e){console.error("Alternative removal also failed:",e)}}else{let e=`cd ${o.default.dirname(s)} && rm -rf ${l}`;console.log(e),(0,t.execSync)(e)}};