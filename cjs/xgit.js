#!/usr/bin/env node
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@octokit/rest"),o=/*#__PURE__*/i(require("yargs")),t=require("jnu-abc"),a=require("./git.js"),s=require("./cli.js"),r=/*#__PURE__*/i(require("path"));function i(e){return e&&e.__esModule?e:{default:e}}const n=o.default.usage("Usage: -e <exec> -u <userName> -n <repoName> -d <description> -p <isPrivate> -l <location>").option("e",{alias:"exec",default:"copyRepo",describe:"exec command: copyRepo(clone+config)/makeRepo(create+push)/removeRepo(delete)/pull(fetch latest)/sync(auto commit+push+pull)/list(repos)/userlist(users)",type:"string",demandOption:!0}).option("u",{alias:"userName",default:"mooninlearn",describe:"Name of User",type:"string"}).option("n",{alias:"repoName",describe:"NameOfRepository",type:"string"}).option("p",{alias:"isPrivate",default:!1,describe:"Private Repository",type:"boolean"}).option("s",{alias:"src",default:"local",describe:"Source of Github Account",type:"string"}).option("d",{alias:"description",describe:"Description For Repository",type:"string"}).option("l",{alias:"location",default:"./",describe:'For list command: output file paths (comma-separated, e.g., "./_docs/list.md,./_docs/list.json"). For other commands: base directory location for operations',type:"string"}).argv;function c(e,o){let a=e.map(e=>({name:e.name,url:e.html_url,description:e.description||"",created_at:e.created_at,updated_at:e.updated_at}));o.forEach(e=>{let o=r.default.resolve(e),s=r.default.dirname(o),i=r.default.extname(o).toLowerCase();try{if((0,t.makeDir)(s),".md"===i){let e,s=(e="| sn | name | url | description | created_at | updated_at |\n|----|------|-----|-------------|------------|------------|\n",a.forEach((o,t)=>{let a=o.name||"",s=o.url||"",r=(o.description||"").replace(/\|/g,"\\|"),i=o.created_at?new Date(o.created_at).toISOString().split("T")[0]:"",n=o.updated_at?new Date(o.updated_at).toISOString().split("T")[0]:"";e+=`| ${t+1} | ${a} | ${s} | ${r} | ${i} | ${n} |
`}),e);(0,t.saveFile)(o,s,{overwrite:!0}),console.log(`âœ… Markdown table saved to: ${o}`)}else".json"===i?((0,t.saveJson)(o,a,{overwrite:!0}),console.log(`âœ… JSON data saved to: ${o}`)):console.warn(`âš ï¸  Unsupported file extension: ${i} for ${o}`)}catch(e){console.error(`âŒ Failed to save to ${o}:`,e)}})}function l(e,o){let a=r.default.resolve(o),s=r.default.dirname(a),i=r.default.extname(a).toLowerCase();try{(0,t.makeDir)(s),".json"===i?((0,t.saveJson)(a,e,{overwrite:!0}),console.log(`âœ… User data saved to: ${a}`)):console.warn(`âš ï¸  Only JSON format is supported for user data: ${a}`)}catch(e){console.error(`âŒ Failed to save user data to ${a}:`,e)}}(async()=>{try{var o,t;let r,i,p=await (0,a.findGithubAccount)(n.userName??"","github");p||(console.error(`âŒ GitHub ê³„ì • ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${n.userName}`),console.log(`ğŸ’¡ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì‹œë„í•´ë³´ì„¸ìš”:`),console.log(`   1. ê³„ì • ì„¤ì •: xgit -e setAccount -n "Full Name" -e "email@example.com" -t "í† í°" -u "${n.userName}"`),console.log(`   2. ë‹¤ë¥¸ ê³„ì •ëª…ìœ¼ë¡œ ì‹œë„: xgit -e list -u "ë‹¤ë¥¸ê³„ì •ëª…"`),console.log(`   3. ì‚¬ìš© ê°€ëŠ¥í•œ ê³„ì • ëª©ë¡ í™•ì¸: xgit -e userlist`),process.exit(1)),p.userName=n.userName??p.userName,console.log(`@@@ git account: ${JSON.stringify(p)}`);let u=new e.Octokit({auth:p.token}),d=(o=n.repoName??"",(i=(i=(t=n.location)&&"./"!==t?t.startsWith("/")?t:`${(0,s.getCurrentDir)()}/${t}`:(0,s.getCurrentDir)()).replace(/\/$/,"")).split("/").pop()!==o&&(i+=`/${o}`),i??"");switch(n.exec){case"list":case"listRepos":try{if(r=await (0,a.findAllRepos)(u),console.log(`ğŸ“Š Found ${r.length} repositories for user: ${n.userName}`),n.location&&"./"!==n.location){let e=n.location.split(",").map(e=>e.trim());c(r,e)}else c(r,["./_docs/list.md","./_docs/list.json"]);let e=r.slice(0,10);console.log("\nğŸ“‹ Repository List (showing first 10):"),e.forEach((e,o)=>{console.log(`${o+1}. ${e.name} - ${e.html_url}`),console.log(`   ğŸ“ ${e.description||"No description"}`),console.log(`   ğŸ“… Created: ${new Date(e.created_at).toLocaleDateString()}, Updated: ${new Date(e.updated_at).toLocaleDateString()}
`)}),r.length>10&&console.log(`... and ${r.length-10} more repositories (see output files for complete list)`)}catch(e){e?.status===401||e?.message?.includes("Bad credentials")?(console.warn(`âš ï¸  ì¸ì¦ ì‹¤íŒ¨ë¡œ ê³„ì • '${n.userName}' ê±´ë„ˆëœ€ - í† í°ì„ ì—…ë°ì´íŠ¸í•˜ê±°ë‚˜ ê³„ì • ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”`),console.log(`ğŸ’¡ í•´ê²° ë°©ë²•: xgit -e setAccount -n "Full Name" -e "email@example.com" -t "ìƒˆí† í°" -u "${n.userName}"`)):e?.status===403?console.warn(`âš ï¸  ê¶Œí•œ ë¶€ì¡±ìœ¼ë¡œ ê³„ì • '${n.userName}' ê±´ë„ˆëœ€ - API ì‚¬ìš©ëŸ‰ í•œë„ ì´ˆê³¼ì´ê±°ë‚˜ ì €ì¥ì†Œ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤`):console.error(`âŒ ê³„ì • '${n.userName}' ì €ì¥ì†Œ ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`,e?.message||e),r=[]}break;case"userlist":try{if(r=await (0,a.findAllUsers)("github")){let e=Object.keys(r).length;console.log(`ğŸ“Š Found ${e} users in GitHub account data`),n.location&&"./"!==n.location?l(r,n.location):l(r,"./_docs/users.json"),console.log("\nğŸ‘¥ User List:"),Object.keys(r).forEach((e,o)=>{let t=r[e];console.log(`${o+1}. ${e}`),console.log(`   ğŸ“§ ${t.email||"No email"}`),console.log(`   ğŸ‘¤ ${t.fullName||"No full name"}
`)})}else console.log("âŒ No user data found")}catch(e){console.error("ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",e)}break;case"create":case"createRemoteRepo":console.log(`createRemoteRepo: ${n}`),await (0,a.createRemoteRepo)(u,{name:n.repoName??"",description:n.description??"",isPrivate:n.isPrivate??!1});break;case"del":case"deleteRemoteRepo":await (0,a.deleteRemoteRepo)(u,{name:n.repoName??""},p);break;case"setLocalConfig":(0,a.setLocalConfig)({name:n.repoName??"",description:n.description??""},p,d);break;case"clone":case"cloneRepo":(0,a.cloneRepo)({name:n.repoName??"",description:n.description??""},p,d);break;case"initLocalRepo":(0,a.initLocalRepo)({name:n.repoName??"",description:n.description??""},p,d);break;case"initRepo":console.log("====initRepo"),await (0,a.initRepo)(u,{name:n.repoName??"",description:n.description??"",isPrivate:n.isPrivate??!1},p,d);break;case"push":case"pushRepo":(0,a.pushRepo)({name:n.repoName??"",description:n.description??""},p,d);break;case"copy":case"copyRepo":(0,a.copyRepo)({name:n.repoName??"",description:n.description??"description",isPrivate:n.isPrivate??!1},p,d);break;case"make":case"makeRepo":(0,a.makeRepo)(u,{name:n.repoName??"",description:n.description??"",isPrivate:n.isPrivate??!1},p,d);break;case"remove":case"removeRepo":await (0,a.removeRepo)(u,{name:n.repoName??""},p,d);break;case"pull":case"pullRepo":(0,a.pullRepo)({name:n.repoName??"",description:n.description??""},p,d);break;case"sync":case"syncRepo":(0,a.syncRepo)({name:n.repoName??"",description:n.description??""},p,d)}}catch(e){e?.status===401||e?.message?.includes("Bad credentials")?(console.error(`âŒ ì¸ì¦ ì‹¤íŒ¨: GitHub í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê³„ì •: ${n.userName}`),console.log(`ğŸ’¡ í•´ê²° ë°©ë²•: ìƒˆë¡œìš´ GitHub Personal Access Tokenì„ ìƒì„±í•˜ê³  ì„¤ì •í•˜ì„¸ìš”`),console.log(`   xgit -e setAccount -n "Full Name" -e "email@example.com" -t "ìƒˆí† í°" -u "${n.userName}"`)):e?.status===403?console.error(`âŒ ê¶Œí•œ ë¶€ì¡±: API ì‚¬ìš©ëŸ‰ í•œë„ ì´ˆê³¼ì´ê±°ë‚˜ ì €ì¥ì†Œ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê³„ì •: ${n.userName}`):n.userName&&""!==n.userName?(console.error(`âŒ ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ ë°œìƒ:`,e?.message||e),console.log(`ğŸ”§ ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:`),console.log(`   1. ì¸í„°ë„· ì—°ê²° ìƒíƒœ`),console.log(`   2. GitHub ì„œë¹„ìŠ¤ ìƒíƒœ`),console.log(`   3. ê³„ì • ì„¤ì • ë° í† í° ìœ íš¨ì„±`)):console.error(`âŒ ì‚¬ìš©ìëª…ì´ ì œê³µë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. -u ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìëª…ì„ ì§€ì •í•˜ì„¸ìš”`),process.exit(1)}})();